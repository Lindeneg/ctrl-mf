!function(){return function e(t,n,o){function r(u,a){if(!n[u]){if(!t[u]){var c="function"==typeof require&&require;if(!a&&c)return c(u,!0);if(i)return i(u,!0);var s=new Error("Cannot find module '"+u+"'");throw s.code="MODULE_NOT_FOUND",s}var l=n[u]={exports:{}};t[u][0].call(l.exports,function(e){return r(t[u][1][e]||e)},l,l.exports,e,t,n,o)}return n[u].exports}for(var i="function"==typeof require&&require,u=0;u<o.length;u++)r(o[u]);return r}}()({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("./modules/app");window.ControlMouseflowInit=o.ControlMouseflow.start},{"./modules/app":2}],2:[function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function u(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(u,a)}c((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,r,i,u={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,o=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(r=(r=u.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){u.label=i[1];break}if(6===i[0]&&u.label<r[1]){u.label=r[1],r=i;break}if(r&&u.label<r[2]){u.label=r[2],u.ops.push(i);break}r[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ControlMouseflow=void 0;var i=e("./util"),u=function(){function e(e,t,n,o){this.wid=e,this.locationRule=t,this.optionalRule=n,this.debug=o,this.log("starting module"),this.sessionInitiated=i.isSessionInitiated(this.wid),this.sessionInitiated?this.log("mouseflow session cookie found"):this.log("mouseflow session cookie not found"),this.onDesiredPage=this.isOnDesiredPage()}return e.prototype.log=function(e){i.logger(this.debug,e)},e.prototype.init=function(){this.onDesiredPage&&(this.sessionInitiated?this.injectMouseflow():function(e){o(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,e.isFromDesiredCountry()];case 1:return t.sent()&&e.injectMouseflow(),[2]}})})}(this))},e.prototype.isOnDesiredPage=function(){var e=window.document.location.pathname,t=!1;if(this.optionalRule.pageRules.length>0)for(var n=0;n<this.optionalRule.pageRules.length;n++){var o=this.optionalRule.pageRules[n];if(i.matchPath(o.pathname,e)){if(i.recordingRateMatch(o.recordingRate))return this.log("page '"+e+"' matched in rule set | recordingRate matched"),!0;this.log("page '"+e+"' matched in rule set | recordingRate not matched"),t=!0}}return!t&&i.isNumber(this.optionalRule.rest.recordingRate)&&i.recordingRateMatch(this.optionalRule.rest.recordingRate)?(this.log("page '"+e+"' not matched in rule set | recordingRate matched"),!0):(!t&&this.log("page '"+e+"' not matched in rule set | recordingRate not matched"),!1)},e.prototype.isFromDesiredCountry=function(){return o(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,i.getAndMatchLocation(this.locationRule,this.debug)];case 1:return[2,e.sent()]}})})},e.prototype.injectMouseflow=function(){var e,t;this.log("injecting mouseflow"),window._mfq=window._mfq||[],e=this.wid,(t=document.createElement("script")).type="text/javascript",t.defer=!0,t.src="//cdn.mouseflow.com/projects/"+e+".js",document.getElementsByTagName("head")[0].appendChild(t)},e.start=function(t){var n=i.validateConfig(t);n.isValid&&new e(n.websiteId,n.locationRule,n.optionalRule,n.debug).init()},e}();n.ControlMouseflow=u},{"./util":3}],3:[function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function u(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(u,a)}c((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,r,i,u={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,o=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(r=(r=u.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){u.label=i[1];break}if(6===i[0]&&u.label<r[1]){u.label=r[1],r=i;break}if(r&&u.label<r[2]){u.label=r[2],u.ops.push(i);break}r[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.matchPath=n.getAndMatchLocation=n.isNumber=n.recordingRateMatch=n.validateConfig=n.isSessionInitiated=n.logger=void 0;var i=function(e){return o(void 0,void 0,void 0,function(){var t;return r(this,function(n){switch(n.label){case 0:return[4,fetch(e)];case 1:return 200===(t=n.sent()).status?[2,t.text()]:[2,""]}})})},u=function(e,t,n){for(var o=e.split("\n"),r=0;r<o.length;r++){var i=o[r].split("="),u=i[0],a=i[1];if("LOC"===u.toUpperCase()&&c(a.toLowerCase(),t,n))return!0}return!1},a=function(e,t,n){return c(e.country.toLowerCase(),t,n)},c=function(e,t,o){if(t.countryCodes.length>0)for(var r=0;r<t.countryCodes.length;r++)if(t.countryCodes[r].toLowerCase()===e)return n.logger(o,"matched country: "+e+" include: "+t.include),t.include;return n.logger(o,"not matched country: "+e+" include: "+!t.include),!t.include};n.logger=function(e,t){e&&console.log("ControlMouseflowDebug: "+t)},n.isSessionInitiated=function(e){return new RegExp("mf_"+e).test(document.cookie)},n.validateConfig=function(e){if(!/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(e.websiteId))throw Error("invalid websiteId provided");if(void 0===e.locationRule.include||void 0===e.locationRule.countryCodes||void 0!==e.locationRule.countryCodes&&e.locationRule.countryCodes.length<=0)throw Error("invalid locationRule provided");return e.optionalRule=e.optionalRule||{pageRules:[],rest:{recordingRate:100}},e.debug=e.debug||!1,e.isValid=!0,e},n.recordingRateMatch=function(e){return Math.floor(100*Math.random()+1)<=e},n.isNumber=function(e){return void 0!==e&&"number"==typeof e&&!Number.isNaN(e)},n.getAndMatchLocation=function(e,t){return o(void 0,void 0,void 0,function(){var c,s;return r(this,function(l){switch(l.label){case 0:return[4,function(e){return n.logger(e,"fetching client location from cloudflare"),i("/cdn-cgi/trace")}(t)];case 1:return(s=l.sent())?[3,3]:[4,function(e){return n.logger(e,"fetching client location from ipapi.co"),i("https://ipapi.co/json/")}(t)];case 2:s=l.sent(),l.label=3;case 3:return[2,!(c=s)||function(e,t,n){return o(void 0,void 0,void 0,function(){var o,i;return r(this,function(r){o=!1;try{i=JSON.parse(e),o=a(i,t,n)}catch(r){o=u(e,t,n)}return[2,o]})})}(c,e,t)]}})})},n.matchPath=function(e,t){var n;if(e=e.toLowerCase(),t=t.toLowerCase(),e.indexOf(".")>-1){var o=/.+?(?=\.)/.exec(e);n=o?o[0]===t:e===t}else n=e===t;return n}},{}]},{},[1]);